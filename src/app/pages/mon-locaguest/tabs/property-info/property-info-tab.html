<div class="space-y-6">
  <!-- Header with actions -->
  <div class="flex items-center justify-between">
    <div>
      <h2 class="text-2xl font-bold text-slate-900 dark:text-white">
        {{ property().name }}
      </h2>
      <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">
        <i class="ph ph-hash mr-1"></i>{{ property().code }}
      </p>
    </div>
    
    @if (!isEditing()) {
      <div class="flex items-center gap-2">
        <button 
          (click)="startEditing()"
          class="px-4 py-2 bg-amber-500 hover:bg-amber-600 text-white rounded-lg font-medium transition flex items-center gap-2">
          <i class="ph ph-pencil-simple"></i>
          Modifier
        </button>

        <button
          (click)="printPropertySheet()"
          [disabled]="isPrintingSheet()"
          class="px-4 py-2 border border-slate-300 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-lg font-medium transition flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
          title="Imprimer la fiche"
        >
          <i class="ph" [class.ph-printer]="!isPrintingSheet()" [class.ph-circle-notch]="isPrintingSheet()" [class.animate-spin]="isPrintingSheet()"></i>
          <span>{{ isPrintingSheet() ? 'Génération...' : 'Imprimer la fiche' }}</span>
        </button>
      </div>
    } @else {
      <div class="flex items-center gap-2">
        <button 
          (click)="cancelEditing()"
          [disabled]="isSaving()"
          class="px-4 py-2 border border-slate-300 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-lg font-medium transition">
          Annuler
        </button>
        <button 
          (click)="saveChanges()"
          [disabled]="isSaving()"
          class="px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg font-medium transition flex items-center gap-2">
          <i class="ph ph-check" [class.ph-spinner]="isSaving()" [class.animate-spin]="isSaving()"></i>
          {{ isSaving() ? 'Enregistrement...' : 'Enregistrer' }}
        </button>
      </div>
    }
  </div>

  <div class="grid lg:grid-cols-3 gap-6">
    <!-- Left Column - Photos -->
    <div class="lg:col-span-1">
      <div class="bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl overflow-hidden">
        <!-- Photo Carousel -->
        <div class="relative aspect-[4/3] bg-slate-100 dark:bg-slate-900">
          @if (hasImages()) {
            <img 
              [src]="currentImage()" 
              [alt]="property().name"
              class="w-full h-full object-contain" />
            
            <!-- Carousel Controls -->
            @if (totalImages() > 1) {
              <button 
                (click)="previousImage()"
                class="absolute left-2 top-1/2 -translate-y-1/2 w-10 h-10 bg-black/50 hover:bg-black/70 text-white rounded-full flex items-center justify-center transition">
                <i class="ph ph-caret-left text-xl"></i>
              </button>
              <button 
                (click)="nextImage()"
                class="absolute right-2 top-1/2 -translate-y-1/2 w-10 h-10 bg-black/50 hover:bg-black/70 text-white rounded-full flex items-center justify-center transition">
                <i class="ph ph-caret-right text-xl"></i>
              </button>

              <!-- Indicators -->
              <div class="absolute bottom-3 left-1/2 -translate-x-1/2 flex items-center gap-2">
                @for (img of property().imageUrls; track img; let i = $index) {
                  <button 
                    (click)="goToImage(i)"
                    [class.bg-white]="i === currentImageIndex()"
                    [class.bg-white/50]="i !== currentImageIndex()"
                    class="w-2 h-2 rounded-full transition"></button>
                }
              </div>
            }

            <!-- Image Counter -->
            <div class="absolute top-3 right-3 px-3 py-1 bg-black/70 text-white text-sm rounded-full">
              {{ currentImageIndex() + 1 }} / {{ totalImages() }}
            </div>
            
            <!-- Delete Current Image Button -->
            <button 
              (click)="deleteImage(currentImageIndex())"
              class="absolute top-3 left-3 w-10 h-10 bg-red-500/80 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition"
              [title]="'PROPERTY.INFO.PHOTOS.DELETE_CURRENT' | translate">
              <i class="ph ph-trash text-lg"></i>
            </button>
          } @else {
            <div class="w-full h-full flex flex-col items-center justify-center text-slate-400">
              <i class="ph ph-image text-6xl mb-2"></i>
              <p class="text-sm">{{ 'PROPERTY.INFO.PHOTOS.NONE' | translate }}</p>
            </div>
          }
          
          <!-- ✅ Add Photos Button (Always visible) -->
          <button 
            (click)="triggerImageUpload()"
            [disabled]="isUploadingImages()"
            class="absolute bottom-3 left-3 px-4 py-2 bg-gradient-to-r from-emerald-500 to-teal-600 hover:shadow-lg text-white rounded-lg font-medium transition flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
            [title]="'PROPERTY.INFO.PHOTOS.ADD' | translate">
            @if (isUploadingImages()) {
              <i class="ph ph-circle-notch animate-spin"></i>
              <span class="text-sm">{{ 'PROPERTY.INFO.PHOTOS.UPLOADING' | translate }}</span>
            } @else {
              <i class="ph ph-camera-plus text-lg"></i>
              <span class="text-sm">{{ 'PROPERTY.INFO.PHOTOS.ADD_SHORT' | translate }}</span>
            }
          </button>
        </div>

        <!-- Quick Stats -->
        <div class="p-4 space-y-3">
          <!-- Status -->
          <div class="relative">
            <label class="block text-xs font-medium text-slate-500 dark:text-slate-400 mb-1">
              {{ 'PROPERTY.INFO.FIELDS.STATUS' | translate }}
            </label>
            <button 
              (click)="showStatusDropdown.set(!showStatusDropdown())"
              [disabled]="isEditing()"
              class="w-full px-3 py-2 rounded-lg border border-slate-200 dark:border-slate-700 flex items-center justify-between transition"
              [class.opacity-50]="isEditing()"
              [class.cursor-not-allowed]="isEditing()">
              <span class="flex items-center gap-2">
                <span 
                  [class]="'w-2 h-2 rounded-full bg-' + currentStatus().color + '-500'"></span>
                <span class="font-medium">{{ currentStatus().label | translate }}</span>
              </span>
              <i class="ph ph-caret-down"></i>
            </button>

            <!-- Status Dropdown -->
            @if (showStatusDropdown() && !isEditing()) {
              <div class="absolute top-full left-0 right-0 mt-1 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg shadow-lg z-10 overflow-hidden">
                @for (status of availableStatuses; track status.value) {
                  <button 
                    (click)="changeStatus(status.value)"
                    class="w-full px-3 py-2 flex items-center gap-2 hover:bg-slate-50 dark:hover:bg-slate-700 transition text-left"
                    [class.bg-slate-50]="status.value === property().status"
                    [class.dark:bg-slate-700]="status.value === property().status">
                    <span [class]="'w-2 h-2 rounded-full bg-' + status.color + '-500'"></span>
                    <span>{{ status.label | translate }}</span>
                  </button>
                }
              </div>
            }
          </div>

          <!-- Occupation (for Colocation) -->
          @if (occupationInfo()) {
            <div>
              <label class="block text-xs font-medium text-slate-500 dark:text-slate-400 mb-1">
                {{ 'PROPERTY.INFO.FIELDS.OCCUPANCY' | translate }}
              </label>
              <div class="px-3 py-2 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-sm font-medium text-blue-900 dark:text-blue-100">
                    {{ 'PROPERTY.INFO.COLOCATION.OCCUPIED_OF_TOTAL_SHORT' | translate:{occupied: occupationInfo()!.occupied, total: occupationInfo()!.total} }}
                  </span>
                  <span class="text-xs text-blue-600 dark:text-blue-400">
                    {{ occupationInfo()!.percentage | number:'1.0-0' }}%
                  </span>
                </div>
                <div class="w-full bg-blue-200 dark:bg-blue-800 rounded-full h-2 overflow-hidden">
                  <div 
                    class="bg-blue-500 h-full transition-all duration-300"
                    [style.width.%]="occupationInfo()!.percentage"></div>
                </div>
              </div>
            </div>
          }
        </div>
      </div>
    </div>

    <!-- Right Column - Information -->
    <div class="lg:col-span-2 space-y-6">
      <!-- General Information Card -->
      <div class="bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl p-6">
        <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-4 flex items-center gap-2">
          <i class="ph ph-info text-amber-500"></i>
          {{ 'PROPERTY.INFO.SECTIONS.GENERAL' | translate }}
        </h3>

        <div class="grid md:grid-cols-2 gap-4">
          <!-- Name -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
              Nom / Libellé
            </label>
            @if (isEditing()) {
              <input 
                type="text"
                [(ngModel)]="editForm()!.name"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none" />
            } @else {
              <p class="text-slate-900 dark:text-white font-medium">{{ property().name }}</p>
            }
          </div>

          <!-- Type -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
              Type de bien
            </label>
            @if (isEditing()) {
              <select 
                [(ngModel)]="editForm()!.type"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none">
                @for (type of propertyTypes; track type) {
                  <option [value]="type">{{ getPropertyTypeLabel(type) }}</option>
                }
              </select>
            } @else {
              <p class="text-slate-900 dark:text-white">{{ getPropertyTypeLabel(property().type) }}</p>
            }
          </div>

          <!-- Address (Full width) -->
          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
              Adresse complète
            </label>
            @if (isEditing()) {
              <input 
                type="text"
                [(ngModel)]="editForm()!.address"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none" />
            } @else {
              <p class="text-slate-900 dark:text-white">
                <i class="ph ph-map-pin mr-1 text-slate-400"></i>
                {{ property().address }}
                @if (property().city) {
                  , {{ property().city }}
                }
                @if (property().postalCode) {
                  {{ property().postalCode }}
                }
              </p>
            }
          </div>

          <!-- City -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
              Ville
            </label>
            @if (isEditing()) {
              <input 
                type="text"
                [(ngModel)]="editForm()!.city"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none" />
            } @else {
              <p class="text-slate-900 dark:text-white">{{ property().city || '—' }}</p>
            }
          </div>

          <!-- Postal Code -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
              Code postal
            </label>
            @if (isEditing()) {
              <input 
                type="text"
                [(ngModel)]="editForm()!.postalCode"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none" />
            } @else {
              <p class="text-slate-900 dark:text-white">{{ property().postalCode || '—' }}</p>
            }
          </div>

          <!-- Surface -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
              Superficie
            </label>
            @if (isEditing()) {
              <input 
                type="number"
                [(ngModel)]="editForm()!.surface"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none" />
            } @else {
              <p class="text-slate-900 dark:text-white font-medium">{{ property().surface || 0 }} m²</p>
            }
          </div>

          <!-- Usage Type -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
              {{ 'PROPERTY.INFO.FIELDS.USAGE_TYPE' | translate }}
            </label>
            <div 
              [class]="'inline-flex items-center gap-2 px-3 py-1 rounded-lg text-sm font-medium bg-' + getUsageTypeColor(property().propertyUsageType) + '-100 text-' + getUsageTypeColor(property().propertyUsageType) + '-700 dark:bg-' + getUsageTypeColor(property().propertyUsageType) + '-900/30 dark:text-' + getUsageTypeColor(property().propertyUsageType) + '-400'">
              <i [class]="getUsageTypeIcon(property().propertyUsageType)"></i>
              {{ getUsageTypeLabel(property().propertyUsageType) | translate }}
            </div>
          </div>

          <!-- Insurance -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
              {{ 'PROPERTY.INFO.FIELDS.INSURANCE_MONTHLY' | translate }}
            </label>
            @if (isEditing()) {
              <div class="relative">
                <input 
                  type="number"
                  [(ngModel)]="editForm()!.insurance"
                  class="w-full pl-6 pr-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none" />
                <span class="absolute left-2 top-1/2 -translate-y-1/2 text-slate-400">€</span>
              </div>
            } @else {
              <p class="text-lg font-semibold text-slate-900 dark:text-white">
                @if (property().insurance) {
                  {{ property().insurance | number:'1.2-2' }} €
                } @else {
                  <span class="text-sm text-slate-400">{{ 'COMMON.NA' | translate }}</span>
                }
              </p>
            }
          </div>

          <!-- Management Fees Rate -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
              {{ 'PROPERTY.INFO.FIELDS.MANAGEMENT_FEES_RATE' | translate }}
            </label>
            @if (isEditing()) {
              <div class="relative">
                <input 
                  type="number"
                  [(ngModel)]="editForm()!.managementFeesRate"
                  class="w-full pr-8 pl-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none" />
                <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400">%</span>
              </div>
            } @else {
              <p class="text-lg font-semibold text-slate-900 dark:text-white">
                @if (property().managementFeesRate !== undefined && property().managementFeesRate !== null) {
                  {{ property().managementFeesRate | number:'1.1-1' }} %
                } @else {
                  <span class="text-sm text-slate-400">{{ 'COMMON.NA' | translate }}</span>
                }
              </p>
            }
          </div>

          <!-- Maintenance Rate -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
              {{ 'PROPERTY.INFO.FIELDS.MAINTENANCE_RATE' | translate }}
            </label>
            @if (isEditing()) {
              <div class="relative">
                <input 
                  type="number"
                  [(ngModel)]="editForm()!.maintenanceRate"
                  class="w-full pr-8 pl-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none" />
                <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400">%</span>
              </div>
            } @else {
              <p class="text-lg font-semibold text-slate-900 dark:text-white">
                @if (property().maintenanceRate !== undefined && property().maintenanceRate !== null) {
                  {{ property().maintenanceRate | number:'1.1-1' }} %
                } @else {
                  <span class="text-sm text-slate-400">{{ 'COMMON.NA' | translate }}</span>
                }
              </p>
            }
          </div>

          <!-- Vacancy Rate -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
              {{ 'PROPERTY.INFO.FIELDS.VACANCY_RATE' | translate }}
            </label>
            @if (isEditing()) {
              <div class="relative">
                <input 
                  type="number"
                  [(ngModel)]="editForm()!.vacancyRate"
                  class="w-full pr-8 pl-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none" />
                <span class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400">%</span>
              </div>
            } @else {
              <p class="text-lg font-semibold text-slate-900 dark:text-white">
                @if (property().vacancyRate !== undefined && property().vacancyRate !== null) {
                  {{ property().vacancyRate | number:'1.1-1' }} %
                } @else {
                  <span class="text-sm text-slate-400">{{ 'COMMON.NA' | translate }}</span>
                }
              </p>
            }
          </div>

          @if (property().propertyUsageType.toLowerCase() === 'airbnb') {
            <!-- Airbnb Nights booked per month -->
            <div>
              <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
                {{ 'PROPERTY.INFO.FIELDS.NIGHTS_BOOKED_PER_MONTH' | translate }}
              </label>
              @if (isEditing()) {
                <input 
                  type="number"
                  [(ngModel)]="editForm()!.nightsBookedPerMonth"
                  class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none" />
              } @else {
                <p class="text-lg font-semibold text-slate-900 dark:text-white">
                  @if (property().nightsBookedPerMonth !== undefined && property().nightsBookedPerMonth !== null) {
                    {{ property().nightsBookedPerMonth }}
                  } @else {
                    <span class="text-sm text-slate-400">{{ 'COMMON.NA' | translate }}</span>
                  }
                </p>
              }
            </div>
          }
        </div>
      </div>

      <!-- Property Details Card -->
      <div class="bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl p-6">
        <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-4 flex items-center gap-2">
          <i class="ph ph-list-dashes text-amber-500"></i>
          Détails du bien
        </h3>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <!-- Bedrooms -->
          <div class="text-center p-4 bg-slate-50 dark:bg-slate-900/50 rounded-lg">
            <i class="ph ph-bed text-3xl text-slate-400 mb-2"></i>
            @if (isEditing()) {
              <input 
                type="number"
                [(ngModel)]="editForm()!.bedrooms"
                class="w-full text-center px-2 py-1 border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-800 text-lg font-bold" />
            } @else {
              <p class="text-2xl font-bold text-slate-900 dark:text-white">{{ property().bedrooms || 0 }}</p>
            }
            <p class="text-sm text-slate-500">Chambres</p>
          </div>

          <!-- Bathrooms -->
          <div class="text-center p-4 bg-slate-50 dark:bg-slate-900/50 rounded-lg">
            <i class="ph ph-bathtub text-3xl text-slate-400 mb-2"></i>
            @if (isEditing()) {
              <input 
                type="number"
                [(ngModel)]="editForm()!.bathrooms"
                class="w-full text-center px-2 py-1 border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-800 text-lg font-bold" />
            } @else {
              <p class="text-2xl font-bold text-slate-900 dark:text-white">{{ property().bathrooms || 0 }}</p>
            }
            <p class="text-sm text-slate-500">Salles de bain</p>
          </div>

          <!-- Floor -->
          <div class="text-center p-4 bg-slate-50 dark:bg-slate-900/50 rounded-lg">
            <i class="ph ph-stairs text-3xl text-slate-400 mb-2"></i>
            @if (isEditing()) {
              <input 
                type="number"
                [(ngModel)]="editForm()!.floor"
                class="w-full text-center px-2 py-1 border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-800 text-lg font-bold" />
            } @else {
              <p class="text-2xl font-bold text-slate-900 dark:text-white">{{ property().floor ?? '—' }}</p>
            }
            <p class="text-sm text-slate-500">Étage</p>
          </div>

          <!-- Elevator -->
          <div class="text-center p-4 bg-slate-50 dark:bg-slate-900/50 rounded-lg">
            <i class="ph text-3xl text-slate-400 mb-2" [class.ph-elevator]="property().hasElevator" [class.ph-x-circle]="!property().hasElevator"></i>
            @if (isEditing()) {
              <label class="flex items-center justify-center gap-2 cursor-pointer">
                <input 
                  type="checkbox"
                  [(ngModel)]="editForm()!.hasElevator"
                  class="w-5 h-5 rounded border-slate-300 text-amber-500 focus:ring-amber-500" />
              </label>
            } @else {
              <p class="text-2xl font-bold" [class.text-emerald-500]="property().hasElevator" [class.text-slate-400]="!property().hasElevator">
                {{ property().hasElevator ? 'Oui' : 'Non' }}
              </p>
            }
            <p class="text-sm text-slate-500">Ascenseur</p>
          </div>

          <!-- Parking -->
          <div class="text-center p-4 bg-slate-50 dark:bg-slate-900/50 rounded-lg">
            <i class="ph text-3xl text-slate-400 mb-2" [class.ph-car]="property().hasParking" [class.ph-x-circle]="!property().hasParking"></i>
            @if (isEditing()) {
              <label class="flex items-center justify-center gap-2 cursor-pointer">
                <input 
                  type="checkbox"
                  [(ngModel)]="editForm()!.hasParking"
                  class="w-5 h-5 rounded border-slate-300 text-amber-500 focus:ring-amber-500" />
              </label>
            } @else {
              <p class="text-2xl font-bold" [class.text-emerald-500]="property().hasParking" [class.text-slate-400]="!property().hasParking">
                {{ property().hasParking ? 'Oui' : 'Non' }}
              </p>
            }
            <p class="text-sm text-slate-500">Parking</p>
          </div>

          <!-- Furnished -->
          <div class="text-center p-4 bg-slate-50 dark:bg-slate-900/50 rounded-lg">
            <i class="ph text-3xl text-slate-400 mb-2" [class.ph-couch]="property().isFurnished" [class.ph-x-circle]="!property().isFurnished"></i>
            @if (isEditing()) {
              <label class="flex items-center justify-center gap-2 cursor-pointer">
                <input 
                  type="checkbox"
                  [(ngModel)]="editForm()!.isFurnished"
                  class="w-5 h-5 rounded border-slate-300 text-amber-500 focus:ring-amber-500" />
              </label>
            } @else {
              <p class="text-2xl font-bold" [class.text-emerald-500]="property().isFurnished" [class.text-slate-400]="!property().isFurnished">
                {{ property().isFurnished ? 'Oui' : 'Non' }}
              </p>
            }
            <p class="text-sm text-slate-500">Meublé</p>
          </div>
        </div>
      </div>

      <!-- Financial Information Card -->
      <div class="bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl p-6">
        <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-4 flex items-center gap-2">
          <i class="ph ph-currency-eur text-amber-500"></i>
          Informations financières
        </h3>

        <div class="grid md:grid-cols-3 gap-4">
          <!-- Rent -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
              Loyer de référence
            </label>
            @if (isEditing()) {
              <div class="relative">
                <input 
                  type="number"
                  [(ngModel)]="editForm()!.rent"
                  class="w-full pl-6 pr-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none" />
                <span class="absolute left-2 top-1/2 -translate-y-1/2 text-slate-400">€</span>
              </div>
            } @else {
              <p class="text-2xl font-bold text-emerald-600">
                @if (property().rent > 0) {
                  {{ property().rent | number:'1.2-2' }} €
                } @else {
                  <span class="text-orange-500 text-sm">{{ 'COMMON.NOT_PROVIDED' | translate }}</span>
                }
              </p>
            }
          </div>

          <!-- Charges -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
              {{ 'PROPERTY.INFO.FIELDS.CHARGES' | translate }}
            </label>
            @if (isEditing()) {
              <div class="relative">
                <input 
                  type="number"
                  [(ngModel)]="editForm()!.charges"
                  class="w-full pl-6 pr-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none" />
                <span class="absolute left-2 top-1/2 -translate-y-1/2 text-slate-400">€</span>
              </div>
            } @else {
              <p class="text-xl font-semibold text-slate-900 dark:text-white">{{ property().charges || 0 | number:'1.2-2' }} €</p>
            }
          </div>

          <!-- Deposit -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
              {{ 'PROPERTY.INFO.FIELDS.DEPOSIT' | translate }}
            </label>
            @if (isEditing()) {
              <div class="relative">
                <input 
                  type="number"
                  [(ngModel)]="editForm()!.deposit"
                  class="w-full pl-6 pr-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none" />
                <span class="absolute left-2 top-1/2 -translate-y-1/2 text-slate-400">€</span>
              </div>
            } @else {
              <p class="text-xl font-semibold text-slate-900 dark:text-white">{{ property().deposit || 0 | number:'1.2-2' }} €</p>
            }
          </div>

          <!-- Purchase Price -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
              {{ 'PROPERTY.INFO.FIELDS.PURCHASE_PRICE' | translate }}
            </label>
            @if (isEditing()) {
              <div class="relative">
                <input 
                  type="number"
                  [(ngModel)]="editForm()!.purchasePrice"
                  class="w-full pl-6 pr-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none" />
                <span class="absolute left-2 top-1/2 -translate-y-1/2 text-slate-400">€</span>
              </div>
            } @else {
              <p class="text-lg font-semibold text-slate-900 dark:text-white">
                @if (property().purchasePrice) {
                  {{ property().purchasePrice | number:'1.2-2' }} €
                } @else {
                  <span class="text-sm text-slate-400">{{ 'COMMON.NA' | translate }}</span>
                }
              </p>
            }
          </div>

          <!-- Purchase Date -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
              {{ 'PROPERTY.INFO.FIELDS.PURCHASE_DATE' | translate }}
            </label>
            @if (isEditing()) {
              <input 
                type="date"
                [(ngModel)]="editForm()!.purchaseDate"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none" />
            } @else {
              <p class="text-lg font-semibold text-slate-900 dark:text-white">
                @if (property().purchaseDate) {
                  {{ property().purchaseDate | date:'dd/MM/yyyy' }}
                } @else {
                  <span class="text-sm text-slate-400">{{ 'COMMON.NA' | translate }}</span>
                }
              </p>
            }
          </div>

          <!-- Property Tax -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
              {{ 'PROPERTY.INFO.FIELDS.PROPERTY_TAX' | translate }}
            </label>
            @if (isEditing()) {
              <div class="relative">
                <input 
                  type="number"
                  [(ngModel)]="editForm()!.propertyTax"
                  class="w-full pl-6 pr-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none" />
                <span class="absolute left-2 top-1/2 -translate-y-1/2 text-slate-400">€</span>
              </div>
            } @else {
              <p class="text-lg font-semibold text-slate-900 dark:text-white">
                @if (property().propertyTax) {
                  {{ property().propertyTax | number:'1.2-2' }} €
                } @else {
                  <span class="text-sm text-slate-400">{{ 'COMMON.NA' | translate }}</span>
                }
              </p>
            }
          </div>

          <!-- Condominium Charges -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
              {{ 'PROPERTY.INFO.FIELDS.CONDO_CHARGES' | translate }}
            </label>
            @if (isEditing()) {
              <div class="relative">
                <input 
                  type="number"
                  [(ngModel)]="editForm()!.condominiumCharges"
                  class="w-full pl-6 pr-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none" />
                <span class="absolute left-2 top-1/2 -translate-y-1/2 text-slate-400">€</span>
              </div>
            } @else {
              <p class="text-lg font-semibold text-slate-900 dark:text-white">
                @if (property().condominiumCharges) {
                  {{ property().condominiumCharges | number:'1.2-2' }} €
                } @else {
                  <span class="text-sm text-slate-400">{{ 'COMMON.NA' | translate }}</span>
                }
              </p>
            }
          </div>
        </div>
      </div>

      <!-- Diagnostics Card -->
      <div class="bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl p-6">
        <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-4 flex items-center gap-2">
          <i class="ph ph-certificate text-amber-500"></i>
          {{ 'PROPERTY.INFO.SECTIONS.DIAGNOSTICS' | translate }}
        </h3>

        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
          <!-- DPE -->
          <div class="p-4 border border-slate-200 dark:border-slate-700 rounded-lg">
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              {{ 'PROPERTY.INFO.DIAGNOSTICS.DPE' | translate }}
            </label>
            @if (isEditing()) {
              <div class="space-y-2">
                <select 
                  [(ngModel)]="editForm()!.dpeRating"
                  class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none text-sm">
                  <option value="">{{ 'COMMON.NOT_PROVIDED' | translate }}</option>
                  <option value="A">A</option>
                  <option value="B">B</option>
                  <option value="C">C</option>
                  <option value="D">D</option>
                  <option value="E">E</option>
                  <option value="F">F</option>
                  <option value="G">G</option>
                </select>
                <input 
                  type="number"
                  [(ngModel)]="editForm()!.dpeValue"
                  [placeholder]="'PROPERTY.INFO.DIAGNOSTICS.DPE_VALUE_PLACEHOLDER' | translate"
                  class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none text-sm" />
              </div>
            } @else {
              @if (property().dpeRating) {
                <div class="flex items-center gap-3">
                  <span [class]="'inline-flex items-center justify-center w-12 h-12 rounded-lg font-bold text-white text-xl ' + getDpeColor(property().dpeRating)">
                    {{ property().dpeRating }}
                  </span>
                  @if (property().dpeValue) {
                    <div class="text-sm">
                      <p class="font-semibold text-slate-900 dark:text-white">{{ property().dpeValue }} kWh/m²/an</p>
                    </div>
                  }
                </div>
              } @else {
                <div class="px-3 py-2 bg-slate-100 dark:bg-slate-700 rounded text-sm text-slate-500">
                  <i class="ph ph-warning-circle mr-1"></i>
                  {{ 'COMMON.NOT_PROVIDED' | translate }}
                </div>
              }
            }
          </div>

          <!-- GES -->
          <div class="p-4 border border-slate-200 dark:border-slate-700 rounded-lg">
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              {{ 'PROPERTY.INFO.DIAGNOSTICS.GES' | translate }}
            </label>
            @if (isEditing()) {
              <select 
                [(ngModel)]="editForm()!.gesRating"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none text-sm">
                <option value="">{{ 'COMMON.NOT_PROVIDED' | translate }}</option>
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="D">D</option>
                <option value="E">E</option>
                <option value="F">F</option>
                <option value="G">G</option>
              </select>
            } @else {
              @if (property().gesRating) {
                <span [class]="'inline-flex items-center justify-center w-12 h-12 rounded-lg font-bold text-white text-xl ' + getGesColor(property().gesRating)">
                  {{ property().gesRating }}
                </span>
              } @else {
                <div class="px-3 py-2 bg-slate-100 dark:bg-slate-700 rounded text-sm text-slate-500">
                  <i class="ph ph-warning-circle mr-1"></i>
                  {{ 'COMMON.NOT_PROVIDED' | translate }}
                </div>
              }
            }
          </div>

          <!-- Electric Diagnostic -->
          <div class="p-4 border border-slate-200 dark:border-slate-700 rounded-lg">
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Diagnostic Électricité
            </label>
            @if (isEditing()) {
              <div class="space-y-2">
                <input 
                  type="date"
                  [(ngModel)]="editForm()!.electricDiagnosticDate"
                  class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none text-sm" />
                <input 
                  type="date"
                  [(ngModel)]="editForm()!.electricDiagnosticExpiry"
                  [placeholder]="'PROPERTY.INFO.DIAGNOSTICS.EXPIRY_DATE_PLACEHOLDER' | translate"
                  class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none text-sm" />
              </div>
            } @else {
              @if (property().electricDiagnosticDate) {
                <div class="text-sm space-y-1">
                  <p class="text-slate-600 dark:text-slate-400">
                    {{ 'PROPERTY.INFO.DIAGNOSTICS.DONE_ON' | translate }} <span class="font-medium text-slate-900 dark:text-white">{{ property().electricDiagnosticDate | date:'dd/MM/yyyy' }}</span>
                  </p>
                  @if (property().electricDiagnosticExpiry) {
                    <p [class]="isDiagnosticExpired(property().electricDiagnosticExpiry) ? 'text-red-600' : 'text-slate-600 dark:text-slate-400'">
                      {{ 'PROPERTY.INFO.DIAGNOSTICS.EXPIRES_ON' | translate }} <span class="font-medium">{{ property().electricDiagnosticExpiry | date:'dd/MM/yyyy' }}</span>
                    </p>
                  }
                </div>
              } @else {
                <div class="px-3 py-2 bg-slate-100 dark:bg-slate-700 rounded text-sm text-slate-500">
                  {{ 'COMMON.NOT_PROVIDED' | translate }}
                </div>
              }
            }
          </div>

          <!-- Gas Diagnostic -->
          <div class="p-4 border border-slate-200 dark:border-slate-700 rounded-lg">
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              {{ 'PROPERTY.INFO.DIAGNOSTICS.GAS' | translate }}
            </label>
            @if (isEditing()) {
              <div class="space-y-2">
                <input 
                  type="date"
                  [(ngModel)]="editForm()!.gasDiagnosticDate"
                  class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none text-sm" />
                <input 
                  type="date"
                  [(ngModel)]="editForm()!.gasDiagnosticExpiry"
                  [placeholder]="'PROPERTY.INFO.DIAGNOSTICS.EXPIRY_DATE_PLACEHOLDER' | translate"
                  class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none text-sm" />
              </div>
            } @else {
              @if (property().gasDiagnosticDate) {
                <div class="text-sm space-y-1">
                  <p class="text-slate-600 dark:text-slate-400">
                    {{ 'PROPERTY.INFO.DIAGNOSTICS.DONE_ON' | translate }} <span class="font-medium text-slate-900 dark:text-white">{{ property().gasDiagnosticDate | date:'dd/MM/yyyy' }}</span>
                  </p>
                  @if (property().gasDiagnosticExpiry) {
                    <p [class]="isDiagnosticExpired(property().gasDiagnosticExpiry) ? 'text-red-600' : 'text-slate-600 dark:text-slate-400'">
                      {{ 'PROPERTY.INFO.DIAGNOSTICS.EXPIRES_ON' | translate }} <span class="font-medium">{{ property().gasDiagnosticExpiry | date:'dd/MM/yyyy' }}</span>
                    </p>
                  }
                </div>
              } @else {
                <div class="px-3 py-2 bg-slate-100 dark:bg-slate-700 rounded text-sm text-slate-500">
                  Non renseigné
                </div>
              }
            }
          </div>

          <!-- Asbestos -->
          <div class="p-4 border border-slate-200 dark:border-slate-700 rounded-lg">
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Amiante
            </label>
            @if (isEditing()) {
              <div class="space-y-2">
                <select 
                  [(ngModel)]="editForm()!.hasAsbestos"
                  class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none text-sm">
                  <option [ngValue]="null">Non renseigné</option>
                  <option [ngValue]="false">Absent</option>
                  <option [ngValue]="true">Présent</option>
                </select>
                @if (editForm()!.hasAsbestos) {
                  <input 
                    type="date"
                    [(ngModel)]="editForm()!.asbestosDiagnosticDate"
                    placeholder="Date diagnostic"
                    class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none text-sm" />
                }
              </div>
            } @else {
              @if (property().hasAsbestos !== null && property().hasAsbestos !== undefined) {
                <div class="flex items-center gap-2">
                  @if (property().hasAsbestos) {
                    <span class="px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm font-medium">
                      <i class="ph ph-warning-circle mr-1"></i>
                      Présent
                    </span>
                  } @else {
                    <span class="px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-sm font-medium">
                      <i class="ph ph-check-circle mr-1"></i>
                      Absent
                    </span>
                  }
                </div>
                @if (property().hasAsbestos && property().asbestosDiagnosticDate) {
                  <p class="text-xs text-slate-600 dark:text-slate-400 mt-1">
                    Diagnostic: {{ property().asbestosDiagnosticDate | date:'dd/MM/yyyy' }}
                  </p>
                }
              } @else {
                <div class="px-3 py-2 bg-slate-100 dark:bg-slate-700 rounded text-sm text-slate-500">
                  Non renseigné
                </div>
              }
            }
          </div>

          <!-- ERP -->
          <div class="p-4 border border-slate-200 dark:border-slate-700 rounded-lg">
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              ERP (État des Risques)
            </label>
            @if (isEditing()) {
              <input 
                type="text"
                [(ngModel)]="editForm()!.erpZone"
                placeholder="Zone de risques"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none text-sm" />
            } @else {
              @if (property().erpZone) {
                <p class="text-sm font-medium text-slate-900 dark:text-white">{{ property().erpZone }}</p>
              } @else {
                <div class="px-3 py-2 bg-slate-100 dark:bg-slate-700 rounded text-sm text-slate-500">
                  Non renseigné
                </div>
              }
            }
          </div>
        </div>
      </div>

      <!-- Colocation Info Card (Only if isColocation) -->
      @if (isColocation()) {
        <div class="bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl p-6">
          <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-4 flex items-center gap-2">
            <i class="ph ph-users-three text-amber-500"></i>
            Informations colocation
          </h3>

          <div class="grid md:grid-cols-2 gap-6">
            <!-- Stats -->
            <div class="space-y-4">
              <div class="flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                <span class="text-sm font-medium text-slate-700 dark:text-slate-300">{{ 'PROPERTY.INFO.COLOCATION.TOTAL_ROOMS' | translate }}</span>
                <span class="text-2xl font-bold text-blue-600">{{ property().totalRooms || 0 }}</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded-lg">
                <span class="text-sm font-medium text-slate-700 dark:text-slate-300">Chambres occupées</span>
                <span class="text-2xl font-bold text-emerald-600">{{ property().occupiedRooms || 0 }}</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg">
                <span class="text-sm font-medium text-slate-700 dark:text-slate-300">Chambres réservées</span>
                <span class="text-2xl font-bold text-amber-600">{{ property().reservedRooms || 0 }}</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-900/50 rounded-lg">
                <span class="text-sm font-medium text-slate-700 dark:text-slate-300">Chambres disponibles</span>
                <span class="text-2xl font-bold text-slate-600">{{ (property().totalRooms || 0) - (property().occupiedRooms || 0) - (property().reservedRooms || 0) }}</span>
              </div>
            </div>

            <!-- Progress visualization -->
            <div class="flex flex-col justify-center">
              <div class="mb-2">
                <span class="text-sm font-medium text-slate-700 dark:text-slate-300">{{ 'PROPERTY.INFO.COLOCATION.OCCUPANCY_RATE' | translate }}</span>
              </div>
              <div class="relative">
                <div class="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-8 overflow-hidden">
                  <div 
                    class="bg-gradient-to-r from-blue-500 to-emerald-500 h-full flex items-center justify-center text-white font-bold text-sm transition-all duration-300"
                    [style.width.%]="getOccupancyRate()">
                    {{ getOccupancyRate() | number:'1.0-0' }}%
                  </div>
                </div>
              </div>
              <p class="text-xs text-slate-500 dark:text-slate-400 mt-2 text-center">
                @if (getOccupancyRate() === 100) {
                  Colocation complètement occupée
                } @else if (getOccupancyRate() === 0) {
                  Aucune chambre occupée
                } @else {
                  {{ property().occupiedRooms }} sur {{ property().totalRooms }} chambres occupées
                }
              </p>
            </div>
          </div>

          @if (!property().totalRooms || property().totalRooms === 0) {
            <div class="mt-4 p-3 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg">
              <p class="text-sm text-orange-800 dark:text-orange-200">
                <i class="ph ph-warning mr-1"></i>
                <strong>Attention:</strong> Le nombre total de chambres n'est pas renseigné. Veuillez compléter cette information.
              </p>
            </div>
          }
        </div>
      }

      <!-- Administrative Info Card -->
      <div class="bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl p-6">
        <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-4 flex items-center gap-2">
          <i class="ph ph-file-text text-amber-500"></i>
          Informations administratives
        </h3>

        <div class="grid md:grid-cols-2 gap-4">
          <!-- Cadastral Reference -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
              Référence cadastrale
            </label>
            @if (isEditing()) {
              <input 
                type="text"
                [(ngModel)]="editForm()!.cadastralReference"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none" />
            } @else {
              <p class="text-slate-900 dark:text-white font-mono text-sm">
                @if (property().cadastralReference) {
                  {{ property().cadastralReference }}
                } @else {
                  <span class="text-slate-400">Non renseignée</span>
                }
              </p>
            }
          </div>

          <!-- Lot Number -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
              Numéro de lot
            </label>
            @if (isEditing()) {
              <input 
                type="text"
                [(ngModel)]="editForm()!.lotNumber"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none" />
            } @else {
              <p class="text-slate-900 dark:text-white">
                @if (property().lotNumber) {
                  {{ property().lotNumber }}
                } @else {
                  <span class="text-slate-400">Non renseigné</span>
                }
              </p>
            }
          </div>

          <!-- Acquisition Date -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
              Date d'acquisition
            </label>
            @if (isEditing()) {
              <input 
                type="date"
                [(ngModel)]="editForm()!.purchaseDate"
                class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none" />
            } @else {
              <p class="text-slate-900 dark:text-white">
                @if (property().purchaseDate) {
                  {{ property().purchaseDate | date:'dd/MM/yyyy' }}
                } @else {
                  <span class="text-slate-400">Non renseignée</span>
                }
              </p>
            }
          </div>

          <!-- Total Works Amount -->
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">
              Montant total travaux réalisés
            </label>
            @if (isEditing()) {
              <div class="relative">
                <input 
                  type="number"
                  [(ngModel)]="editForm()!.totalWorksAmount"
                  class="w-full pl-6 pr-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none" />
                <span class="absolute left-2 top-1/2 -translate-y-1/2 text-slate-400">€</span>
              </div>
            } @else {
              <p class="text-slate-900 dark:text-white font-semibold">
                @if (property().totalWorksAmount) {
                  {{ property().totalWorksAmount | number:'1.2-2' }} €
                } @else {
                  <span class="text-slate-400 font-normal">Non renseigné</span>
                }
              </p>
            }
          </div>
        </div>
      </div>

      <!-- Notes Card (Optional) -->
      @if (property().description || isEditing()) {
        <div class="bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl p-6">
          <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-4 flex items-center gap-2">
            <i class="ph ph-note text-amber-500"></i>
            Notes
          </h3>

          @if (isEditing()) {
            <textarea 
              [(ngModel)]="editForm()!.description"
              rows="4"
              class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 focus:ring-2 focus:ring-amber-500 outline-none resize-none"
              placeholder="Ajouter des notes..."></textarea>
          } @else {
            <p class="text-slate-600 dark:text-slate-300 whitespace-pre-wrap">{{ property().description }}</p>
          }
        </div>
      }
    </div>
  </div>

  <!-- 📸 Image Upload Modal -->
  @if (showImageUploadModal()) {
    <div class="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4" (click)="cancelImageUpload()">
      <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden" (click)="$event.stopPropagation()">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-500 to-cyan-500 px-6 py-4 flex items-center justify-between">
          <h3 class="text-xl font-bold text-white flex items-center gap-2">
            <i class="ph ph-image-square text-2xl"></i>
            {{ 'PROPERTY.INFO.PHOTOS.CATEGORIZE_TITLE' | translate:{count: pendingImages().length} }}
          </h3>
          <button 
            (click)="cancelImageUpload()"
            class="w-8 h-8 rounded-full hover:bg-white/20 flex items-center justify-center transition">
            <i class="ph ph-x text-white text-xl"></i>
          </button>
        </div>

        <!-- Content -->
        <div class="p-6 overflow-y-auto max-h-[calc(90vh-180px)]">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            @for (img of pendingImages(); track $index; let imgIndex = $index) {
              <div class="bg-slate-50 dark:bg-slate-900 rounded-xl overflow-hidden border border-slate-200 dark:border-slate-700">
                <!-- Image Preview -->
                <div class="relative aspect-video bg-slate-200 dark:bg-slate-800">
                  <img 
                    [src]="img.preview" 
                    alt="Preview"
                    class="w-full h-full object-cover" />
                  
                  <!-- Remove Button -->
                  <button 
                    (click)="removePendingImage(imgIndex)"
                    class="absolute top-2 right-2 w-8 h-8 bg-red-500 hover:bg-red-600 rounded-full flex items-center justify-center text-white shadow-lg transition">
                    <i class="ph ph-trash text-lg"></i>
                  </button>
                </div>

                <!-- Category Selector -->
                <div class="p-4">
                  <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                    {{ 'PROPERTY.INFO.PHOTOS.CATEGORY' | translate }}
                  </label>
                  <div class="grid grid-cols-3 gap-2">
                    @for (cat of imageCategories; track cat.value) {
                      <button
                        (click)="updateImageCategory(imgIndex, cat.value)"
                        [class.bg-blue-500]="img.category === cat.value"
                        [class.text-white]="img.category === cat.value"
                        [class.bg-white]="img.category !== cat.value"
                        [class.dark:bg-slate-800]="img.category !== cat.value"
                        [class.text-slate-700]="img.category !== cat.value"
                        [class.dark:text-slate-300]="img.category !== cat.value"
                        class="px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-xs font-medium transition hover:scale-105 flex items-center justify-center gap-1">
                        <i [class]="cat.icon"></i>
                        <span>{{ cat.label }}</span>
                      </button>
                    }
                  </div>
                </div>
              </div>
            }
          </div>

          @if (pendingImages().length === 0) {
            <div class="text-center py-12">
              <i class="ph ph-image text-6xl text-slate-300 dark:text-slate-600 mb-3"></i>
              <p class="text-slate-500 dark:text-slate-400">{{ 'PROPERTY.INFO.PHOTOS.NONE_SELECTED' | translate }}</p>
            </div>
          }
        </div>

        <!-- Footer -->
        <div class="border-t border-slate-200 dark:border-slate-700 px-6 py-4 flex items-center justify-end gap-3">
          <button 
            (click)="cancelImageUpload()"
            class="px-4 py-2 border border-slate-300 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700 rounded-lg font-medium transition">
            {{ 'COMMON.CANCEL' | translate }}
          </button>
          <button 
            (click)="confirmImageUpload()"
            [disabled]="pendingImages().length === 0 || isUploadingImages()"
            class="px-6 py-2 bg-gradient-to-r from-blue-500 to-cyan-500 hover:shadow-lg text-white rounded-lg font-medium transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
            @if (isUploadingImages()) {
              <i class="ph ph-circle-notch animate-spin"></i>
              <span>{{ 'COMMON.UPLOADING' | translate }}</span>
            } @else {
              <i class="ph ph-upload-simple"></i>
              <span>{{ 'PROPERTY.INFO.PHOTOS.ADD_N' | translate:{count: pendingImages().length} }}</span>
            }
          </button>
        </div>
      </div>
    </div>
  }
</div>
