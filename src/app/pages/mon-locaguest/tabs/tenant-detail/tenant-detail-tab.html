<div class="p-6 space-y-6">
  @if (isLoading()) {
    <div class="flex items-center justify-center py-12">
      <i class="ph ph-spinner text-4xl animate-spin text-slate-400"></i>
    </div>
  } @else if (tenant()) {
    <!-- Header Two Columns -->
    <div class="grid lg:grid-cols-2 gap-6">
      <!-- Left: Tenant Info Card -->
      <div class="bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl p-6">
        <div class="flex items-center gap-4 mb-6">
          <div class="w-20 h-20 rounded-full bg-gradient-to-br from-orange-400 to-rose-500 flex items-center justify-center text-white text-3xl font-bold">
            {{ getInitials(tenant()!.fullName) }}
          </div>
          <div>
            <h3 class="text-xl font-bold">{{ tenant()!.fullName }}</h3>
            <p class="text-sm text-slate-500 dark:text-slate-400">{{ tenant()!.email }}</p>
            @if (tenant()!.phone) {
              <p class="text-sm text-slate-500 dark:text-slate-400">{{ tenant()!.phone }}</p>
            }
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <p class="text-xs text-slate-500 dark:text-slate-400">Contrats actifs</p>
            <p class="font-medium">{{ tenant()!.activeContracts }}</p>
          </div>
          @if (tenant()!.moveInDate) {
            <div>
              <p class="text-xs text-slate-500 dark:text-slate-400">Date d'entrée</p>
              <p class="font-medium">{{ tenant()!.moveInDate | date:'dd MMM yyyy' }}</p>
            </div>
          }
          <div>
            <p class="text-xs text-slate-500 dark:text-slate-400">Statut</p>
            <span class="text-xs px-2 py-1 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30">
              {{ tenant()!.status }}
            </span>
          </div>
        </div>
      </div>

      <!-- Right: Stats Card -->
      <div class="bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl p-6">
        <h3 class="text-lg font-semibold mb-4">{{ 'TENANT.PAYMENT_STATS' | translate }}</h3>
        @if (paymentStats()) {
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div>
              <p class="text-xs text-slate-500 dark:text-slate-400">Total payé</p>
              <p class="text-2xl font-bold text-emerald-600">€ {{ paymentStats()!.totalPaid.toLocaleString() }}</p>
            </div>
            <div>
              <p class="text-xs text-slate-500 dark:text-slate-400">Paiements</p>
              <p class="text-2xl font-bold">{{ paymentStats()!.totalPayments }}</p>
            </div>
            <div>
              <p class="text-xs text-slate-500 dark:text-slate-400">Retards</p>
              <p class="text-lg font-semibold">{{ paymentStats()!.latePayments }}</p>
            </div>
            <div>
              <p class="text-xs text-slate-500 dark:text-slate-400">Régularité</p>
              <p class="text-lg font-semibold text-emerald-600">{{ paymentStats()!.onTimeRate }}%</p>
            </div>
          </div>
        }
        <occupancy-chart />
      </div>
    </div>

    <!-- Sub-tabs -->
    <div class="bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl">
      <div class="flex overflow-x-auto border-b border-slate-200 dark:border-slate-700 px-4">
        @for (tab of subTabs; track tab.id) {
          <button
            (click)="activeSubTab.set(tab.id)"
            [class.border-b-2]="activeSubTab() === tab.id"
            [class.border-orange-500]="activeSubTab() === tab.id"
            [class.text-orange-600]="activeSubTab() === tab.id"
            class="px-4 py-3 text-sm font-medium whitespace-nowrap transition hover:text-orange-600"
          >
            <i [class]="'ph ' + tab.icon + ' mr-2'"></i>{{ tab.label | translate }}
          </button>
        }
      </div>

      <div class="p-6">
        @switch (activeSubTab()) {
          @case ('contracts') {
            <div>
              <h3 class="text-lg font-semibold mb-4">{{ 'TENANT.CONTRACTS' | translate }}</h3>
              @if (contracts().length > 0) {
                <div class="space-y-4">
                  @for (contract of contracts(); track contract.id) {
                    <div 
                      (click)="openPropertyTab(contract)"
                      class="border border-slate-200 dark:border-slate-700 rounded-lg p-4 hover:shadow-md transition cursor-pointer"
                    >
                      <div class="flex items-center gap-4">
                        <div class="w-16 h-16 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-lg"></div>
                        <div class="flex-1">
                          <h4 class="font-semibold">{{ contract.type }}</h4>
                          <p class="text-sm text-slate-500">{{ contract.startDate | date:'dd/MM/yyyy' }} - {{ contract.endDate | date:'dd/MM/yyyy' }}</p>
                          <p class="text-sm font-medium mt-1">€ {{ contract.rent }}/mois</p>
                        </div>
                        <span class="text-xs px-2 py-1 rounded-full bg-emerald-100 text-emerald-700">{{ contract.status }}</span>
                      </div>
                    </div>
                  }
                </div>
              } @else {
                <p class="text-slate-500">{{ 'TENANT.NO_CONTRACTS' | translate }}</p>
              }
            </div>
          }
          @case ('payment-history') {
            <div>
              <h3 class="text-lg font-semibold mb-4">{{ 'TENANT.PAYMENT_HISTORY' | translate }}</h3>
              @if (payments().length > 0) {
                <div class="space-y-2">
                  @for (payment of payments(); track payment.id) {
                    <div class="flex items-center justify-between p-3 border border-slate-200 dark:border-slate-700 rounded-lg">
                      <div>
                        <p class="font-medium">{{ payment.paymentDate | date:'MMM yyyy' }}</p>
                        <p class="text-xs text-slate-500">{{ payment.method }}</p>
                        @if (payment.propertyName) {
                          <p class="text-xs text-slate-400">{{ payment.propertyName }}</p>
                        }
                      </div>
                      <div class="text-right">
                        <p class="font-semibold">€ {{ payment.amount }}</p>
                        <span class="text-xs px-2 py-0.5 rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30">
                          {{ payment.status }}
                        </span>
                      </div>
                    </div>
                  }
                </div>
              } @else {
                <p class="text-slate-500">{{ 'TENANT.NO_PAYMENTS' | translate }}</p>
              }
            </div>
          }
          @case ('documents') {
            <div>
              <h3 class="text-lg font-semibold mb-4">{{ 'TENANT.CONTRACTS_DOCS' | translate }}</h3>
              <div class="grid sm:grid-cols-2 gap-3">
                @for (i of [1,2,3]; track i) {
                  <div class="border border-slate-200 dark:border-slate-700 rounded-lg p-3 flex items-center gap-3">
                    <i class="ph ph-file-pdf text-2xl text-rose-500"></i>
                    <div>
                      <p class="text-sm font-medium">Document {{ i }}.pdf</p>
                      <p class="text-xs text-slate-500">{{ i * 850 }} KB</p>
                    </div>
                  </div>
                }
              </div>
            </div>
          }
        }
      </div>
    </div>
  } @else {
    <div class="text-center text-slate-500 py-12">
      <p>{{ 'TENANT.NOT_FOUND' | translate }}</p>
    </div>
  }
</div>
