<div class="w-full space-y-8">

  <!-- Header -->
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
    <div>
      <h1 class="text-2xl font-semibold text-gray-800">
        {{ 'FINANCIAL.TITLE' | translate }}
      </h1>
      <p class="text-sm text-gray-500">
        {{ 'FINANCIAL.SUBTITLE' | translate }}
      </p>
    </div>

    <div class="flex items-center gap-3">
      <button
        class="flex items-center gap-2 px-3 py-2 text-sm rounded-md bg-gray-100 hover:bg-gray-200 cursor-pointer"
        (click)="export()">
        <i class="ph ph-download-simple"></i>
        {{ 'FINANCIAL.ACTIONS.EXPORT' | translate }}
      </button>

      <select
        class="rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        (change)="changeYear($event)">
        @for (year of [2024, 2023, 2022]; track year) {
          <option [selected]="year === service.selectedYear()">{{ year }}</option>
        }
      </select>
    </div>
  </div>

  <!-- Tabs -->
  <div class="flex border-b mb-4 text-sm font-medium text-gray-600">
    @for (tab of tabs; track tab) {
      <button
        (click)="setTab(tab)"
        class="px-5 py-3 transition-colors cursor-pointer"
        [class.text-blue-600]="activeTab() === tab"
        [class.border-b-2]="activeTab() === tab"
        [class.border-blue-600]="activeTab() === tab"
        [class.bg-gray-100]="activeTab() === tab">
        {{ ( tab) | translate }}
      </button>
    }
  </div>

  <!-- Loader -->
  @if (service.loading()) {
    <div class="flex justify-center py-12">
      <i class="ph ph-spinner animate-spin text-3xl text-blue-600"></i>
      <span class="ml-3 text-gray-600 text-sm">{{ 'FINANCIAL.COMMON.LOADING' | translate }}</span>
    </div>
  }

  <!-- No Data -->
  @if (!service.loading() && !data()) {
    <div class="text-center text-gray-500 py-12">
      {{ 'FINANCIAL.COMMON.NO_DATA' | translate }}
    </div>
  }

  <!-- Overview -->
  @if (activeTab() === "Vue d'ensemble" && data()) {
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
      @for (s of data()?.stats; track s.title) {
        <div class="bg-white rounded-md shadow p-4 flex flex-col justify-between">
          <div>
            <p class="text-sm text-gray-500">{{ s.title | translate }}</p>
            <p class="text-2xl font-bold text-gray-800">{{ s.value }}</p>
          </div>
          @if (s.change) {
            <p class="text-xs mt-1" [ngClass]="s.changeColor">{{ s.change }}</p>
          }
        </div>
      }
    </div>

    <div class="mt-8">
      <h3 class="text-lg font-semibold text-gray-800 mb-3">
        {{ 'FINANCIAL.UPCOMING.TITLE' | translate }}
      </h3>

      <div class="bg-white rounded-md shadow divide-y divide-gray-100">
        @for (item of data()?.upcoming; track item.label) {
          <div class="p-4 flex justify-between text-sm">
            <span>{{ item.label }}</span>
            <span>{{ item.due }}</span>
            <span>{{ item.amount | currency:'EUR' }}</span>
            <span [ngClass]="{
              'text-green-600': item.status === 'paid',
              'text-red-600': item.status === 'pending'
            }">
              {{ item.status | translate }}
            </span>
          </div>
        }
      </div>
    </div>
  }

  <!-- Cash Flow -->
  @if (activeTab() === "Flux de tr√©sorerie" && data()) {
    <div class="space-y-6">

      <h3 class="text-lg font-semibold text-gray-800">
        {{ 'FINANCIAL.CASHFLOW.TITLE' | translate }}
      </h3>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="bg-white rounded-md shadow p-4">
          <h4 class="text-sm font-medium text-gray-500 mb-2">
            {{ 'FINANCIAL.CASHFLOW.INCOME' | translate }}
          </h4>
          @for (i of data()?.incomes; track i.label) {
            <div class="flex justify-between text-sm py-1">
              <span>{{ i.label }}</span>
              <span class="font-medium text-emerald-600">{{ i.amount | currency:'EUR' }}</span>
            </div>
          }
        </div>

        <div class="bg-white rounded-md shadow p-4">
          <h4 class="text-sm font-medium text-gray-500 mb-2">
            {{ 'FINANCIAL.CASHFLOW.EXPENSE' | translate }}
          </h4>
          @for (e of data()?.expenses; track e.label) {
            <div class="flex justify-between text-sm py-1">
              <span>{{ e.label }}</span>
              <span class="font-medium text-red-600">-{{ e.amount | currency:'EUR' }}</span>
            </div>
          }
        </div>
      </div>
    </div>
  }

  <!-- Charges -->
  @if (activeTab() === "Analyse des charges" && data()) {
    <div class="space-y-6">
      <h3 class="text-lg font-semibold text-gray-800">
        {{ 'FINANCIAL.CHARGES.TITLE' | translate }}
      </h3>

      <div class="bg-white rounded-md shadow p-4 space-y-3">
        @for (c of data()?.charges; track c.label) {
          <div class="flex justify-between items-center text-sm">
            <span>{{ c.label }}</span>
            <div class="flex items-center gap-2">
              <span>{{ c.amount | currency:'EUR' }}</span>
              <span class="text-xs text-gray-500">({{ c.percent }}%)</span>
            </div>
          </div>
          <div class="w-full h-1 rounded bg-gray-100">
            <div [style.width.%]="c.percent" [style.backgroundColor]="c.color" class="h-1 rounded"></div>
          </div>
        }
      </div>

      <div class="bg-white rounded-md shadow p-4">
        <h4 class="text-sm font-semibold text-gray-700 mb-2">
          {{ 'FINANCIAL.OPTIMIZATIONS.TITLE' | translate }}
        </h4>
        @for (opt of data()?.optimizations; track opt.title) {
          <div class="border-l-4 p-2 mb-2 rounded" [ngClass]="opt.color">
            <p class="text-sm font-medium text-gray-800">{{ opt.title }}</p>
            <p class="text-xs text-gray-500">{{ opt.description }}</p>
          </div>
        }
      </div>
    </div>
  }

  <!-- Projections -->
  @if (activeTab() === "Projections" && data()) {
    <div class="space-y-8">
      <h3 class="text-lg font-semibold text-gray-800">
        {{ 'FINANCIAL.PROJECTIONS.TITLE' | translate }}
      </h3>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        @for (p of data()?.projections; track p.title) {
          <div class="bg-white rounded-md shadow p-4 flex flex-col justify-between">
            <p class="text-sm text-gray-500">{{ p.title | translate }}</p>
            <p class="text-2xl font-bold text-gray-800">{{ p.value }}</p>
            @if (p.change) {
              <p class="text-xs mt-1" [ngClass]="p.changeColor">{{ p.change }}</p>
            }
          </div>
        }
      </div>

      <div>
        <h4 class="text-lg font-semibold text-gray-800 mb-3">
          {{ 'FINANCIAL.OPPORTUNITIES.TITLE' | translate }}
        </h4>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          @for (o of data()?.opportunities; track o.title) {
            <div class="bg-white rounded-md shadow p-4 flex flex-col justify-between hover:bg-gray-50 transition">
              <div>
                <h5 class="font-medium text-gray-800">{{ o.title }}</h5>
                <p class="text-sm text-gray-500 mb-2">{{ o.desc }}</p>
              </div>
              <div class="text-sm text-gray-700 space-y-1">
                <p><b>{{ 'FINANCIAL.OPPORTUNITIES.PRICE' | translate }}:</b> {{ o.price | currency:'EUR' }}</p>
                <p><b>{{ 'FINANCIAL.OPPORTUNITIES.RENT' | translate }}:</b> {{ o.rent | currency:'EUR' }}</p>
                <p><b>{{ 'FINANCIAL.OPPORTUNITIES.ROI' | translate }}:</b> {{ o.roi }}%</p>
              </div>
            </div>
          }
        </div>
      </div>
    </div>
  }

</div>
